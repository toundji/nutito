"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConnectionOptions = void 0;
const typeorm_1 = require("typeorm");
const DefaultSeederNotDefinedError_1 = require("../errors/DefaultSeederNotDefinedError");
const ConnectionConfigurationManager_1 = require("./ConnectionConfigurationManager");
async function getConnectionOptions() {
    const { root, configName, connection } = ConnectionConfigurationManager_1.ConnectionConfigurationManager.getInstance().configuration;
    const connectionReader = new typeorm_1.ConnectionOptionsReader({
        root,
        configName,
    });
    const options = (await connectionReader.get(connection));
    const seedersFromEnv = process.env.TYPEORM_SEEDING_SEEDERS;
    const defaultSeederFromEnv = process.env.TYPEORM_SEEDING_DEFAULT_SEEDER;
    const defaultSeeder = defaultSeederFromEnv || options.defaultSeeder;
    if (!defaultSeeder) {
        throw new DefaultSeederNotDefinedError_1.DefaultSeederNotDefinedError();
    }
    return {
        ...options,
        seeders: seedersFromEnv ? [seedersFromEnv] : options.seeders || [],
        defaultSeeder,
    };
}
exports.getConnectionOptions = getConnectionOptions;
//# sourceMappingURL=getConnectionOptions.js.map